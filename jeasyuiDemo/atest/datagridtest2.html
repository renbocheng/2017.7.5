<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8" />
		<title>可编辑的数据网格</title>
		<!--引用jquery -->
		<script type="text/javascript" src="../jquery.min.js"></script>
		<!--引用jeasyui -->
		<script type="text/javascript" src="../jquery.easyui.min.js"></script>
		<!-- 引入EasyUI的中文国际化js，让EasyUI支持中文 -->
		<script type="text/javascript" src="../locale/easyui-lang-zh_CN.js"></script>
		<!-- 引入EasyUI的样式文件-->
		<link rel="stylesheet" href="../themes/default/easyui.css" />
		<!-- 引入EasyUI的图标样式文件-->
		<link rel="stylesheet" type="text/css" href="../themes/icon.css" />
		<!-- 样式重置 -->
		<link rel="stylesheet" type="text/css" href="reset.css" />
		<script type="text/javascript">
		</script>

	</head>

	<body>
		<table class="easyui-datagrid" id="dg" title="用户编辑" style="width: 700px;height: auto;" data-options="
					iconCls:'icon-edit',
					singleSelect:true,
					toolbar:'#toolbar',
					url:'datagrid_data1.json',
					method:'get',
					collapsible:true,
					onClickRow:onClickRow
		">
			<thead>
				<tr>
					<th data-options="field:'itemid',width:80">Item ID</th>
					<th data-options="field:'productid',width:100,
									formatter:function(value,row){
										return row.productname;
									},
									editor:{
										type:'combobox',
										options:{
											valueField:'productid',
											textField:'productname',
											method:'get',
											url:'products.json',
											required:true
										}
									}
						">Product</th>
						<th data-options="field:'listprice',width:80,align:'right',editor:{type:'numberbox',options:{precision:2}}">List Price</th>
						<th data-options="field:'unitcost',width:80,algin:'right',editor:{type:'numberbox',options:{precision:2}}">Unit Cost</th>
						<th data-options="field:'attr1',width:250,editor:{type:'textbox'}">Attribute</th>
						<th data-options="field:'status',width:60,align:'center',editor:{type:'checkbox',options:{on:'p',off:'none'}}">Status</th>
				</tr>
			</thead>
			</table>
			<div id="toolbar" style="height: auto;">
				<a href="javascript:void(0);" class="easyui-linkbutton" data-options="iconCls:'icon-add',plain:true,text:'增加'" onclick="append()"></a>
				<a href="javascript:void(0);" class="easyui-linkbutton" data-options="iconCls:'icon-remove',plain:true,text:'删除'" onclick="removeit()"></a>
				<a href="javascript:void(0);" class="easyui-linkbutton" data-options="iconCls:'icon-save',plain:true,text:'保存'" onclick="accept()"></a>
				<a href="javascript:void(0);" class="easyui-linkbutton" data-options="iconCls:'icon-undo',plain:true,text:'撤销'" onclick="reject()"></a>
				<a href="javascript:void(0);" class="easyui-linkbutton" data-options="iconCls:'icon-search',plain:true,text:'更换次数'" onclick="getChanges	()"></a>
			</div>
			<script type="text/javascript">
				var editIndex = undefined;

				function endEditing() {
					if(editIndex == undefined) { return true }
					var dgs = $('#dg');
					if(dgs.datagrid('validateRow', editIndex)) {
						var ed = dgs.datagrid('getEditor', { index: editIndex, field: 'productid' });
						var productname = $(ed.target).combobox('getText');
						dgs.datagrid('getRows')[editIndex]['productname'] = productname;
						dgs.datagrid('endEdit', editIndex);
						editIndex = undefined;
						return true;
					} else {
						return false;
					}
				}

				function onClickRow(index) {
					if(editIndex != index) {
						if(endEditing()) {
	
							$('#dg').datagrid('selectRow', index).datagrid('beginEdit', index);
							editIndex = index;
						} else {
							$('#dg').datagrid('selectRow', editIndex);
							
						}
					}
				}

				function append() {
					if(endEditing()) {
						$('#dg').datagrid('appendRow',{ status:'p'});
						editIndex = $('#dg').datagrid('getRows').length - 1;
						$('#dg').datagrid('selectRow', editIndex).datagrid('beginEdit', editIndex);
					}
				}

				function removeit() {
					if(editIndex == undefined) { return }
					$('#dg').datagrid('cancelEdit', editIndex).datagrid('deleteRow', editIndex);
					editIndex = undefined;
				}

				function accept() {
					if(endEditing()) {
						$('#dg').datagrid('acceptChanges');
					}
				}

				function reject() {
					$('#dg').datagrid('rejectChanges');
					editIndex = undefined;
				}

				function getChanges() {
					var rows = $('#dg').datagrid('getChanges');
					alert(rows.length + ' rows are changed!');
				}
			</script>
	</body>

</html>